(()=>{"use strict";JSON.parse('{"apiURL":"http://localhost:3000","appURL":"http://localhost:3001","redirectURI":"http://localhost:3000/auth/callback"}');const e=JSON.parse('{"apiURL":"sapi.cowell.dev","appURL":"cowell.dev/sapi","redirectURI":"sapi.cowell.dev/auth/callback"}');function t(){return e}var n,s,i=function(e,t,n,s){return new(n||(n=Promise))((function(i,l){function a(e){try{o(s.next(e))}catch(e){l(e)}}function d(e){try{o(s.throw(e))}catch(e){l(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}o((s=s.apply(e,t||[])).next())}))};class l extends HTMLElement{constructor(){super(),this.config=t()}connectedCallback(){const e=this.attachShadow({mode:"open"}),t=document.getElementById("app-template");e.appendChild(t.content.cloneNode(!0)),this.searchElement=e.getElementById("search"),this.searchTypeElement=e.getElementById("search-method"),this.searchResultsElement=e.getElementById("search-results"),this.getPlaylistButton=e.getElementById("get-playlist"),this.danceability=e.getElementById("danceability"),this.energy=e.getElementById("energy"),this.popularity=e.getElementById("popularity"),this.valence=e.getElementById("valence"),this.seedsElement={artist:e.getElementById("artist-seeds"),track:e.getElementById("track-seeds")},this.playlistElement=e.getElementById("playlist"),this.playlistOrdered=e.getElementById("playlist-ordered"),this.savePlaylistButton=e.getElementById("save-playlist"),this.clearPlaylistButton=e.getElementById("clear-playlist"),this.searchElement.addEventListener("keyup",this.handleSearchKeyup.bind(this)),this.searchElement.addEventListener("search",this.handleSearchEvent.bind(this)),this.searchTypeElement.addEventListener("change",this.searchQuery.bind(this)),this.getPlaylistButton.addEventListener("click",this.handleGetPlaylistButtonClick.bind(this)),this.clearPlaylistButton.addEventListener("click",this.clearPlaylist.bind(this))}handleSearchKeyup(e){this.searchElement.value||this.clearResults(),"Enter"===e.key&&this.searchQuery()}handleSearchEvent(e){this.searchElement.value||this.clearResults()}handleGetPlaylistButtonClick(e){if(!this.hasSeeds())return console.error("The button abides");this.getPlaylist()}searchQuery(){var e;return i(this,void 0,void 0,(function*(){const t=this.searchElement.value;if(!t||t.length<1)return;const n=null===(e=this.searchTypeElement.querySelector('input[type="radio"]:checked').parentElement)||void 0===e?void 0:e.textContent;if("artist"!=n&&"track"!=n)return console.error("invalid type");const s=`${this.config.apiURL}/search?q=${t}&type=${n}`;try{const e=yield fetch(s,{method:"GET",credentials:"include"}),t=(yield e.json())[n+"s"].items;this.showResults(t)}catch(e){console.error(e)}}))}showResults(e){var t;null===(t=this.searchResultsElement)||void 0===t||t.replaceChildren(),e.forEach((e=>{var t;const n=document.createElement("li");let s=e.name;"track"==e.type&&(s=e.artists[0].name+" - "+s),n.textContent=s,n.dataset.id=e.id,n.dataset.type=e.type,n.addEventListener("click",this.addItemToSeeds.bind(this)),null===(t=this.searchResultsElement)||void 0===t||t.appendChild(n)}))}clearResults(){this.searchResultsElement.replaceChildren()}addItemToSeeds(e){const t=e.target,n=this.seedsElement[t.dataset.type],s=null==n?void 0:n.querySelectorAll("li");let i=!0;if(null!=s){if(s.length>=5)return void alert("Max of 5 items per seed");null==s||s.forEach((e=>{e.dataset.id!=t.dataset.id||(i=!1)}))}if(i){const e=document.createElement("li");e.textContent=t.textContent,e.dataset.id=t.dataset.id,e.addEventListener("click",this.deleteItemFromSeeds.bind(this)),null==n||n.appendChild(e)}this.checkButton()}deleteItemFromSeeds(e){e.target.remove(),this.checkButton()}hasSeeds(){var e,t,n,s;const i=(null===(t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("artist-seeds"))||void 0===t?void 0:t.hasChildNodes())||!1,l=(null===(s=null===(n=this.shadowRoot)||void 0===n?void 0:n.getElementById("track-seeds"))||void 0===s?void 0:s.hasChildNodes())||!1;return i||l}checkButton(){var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("get-playlist");this.hasSeeds()?t.disabled=!1:t.disabled=!0}getSeeds(e){var t;const n=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById(e+"-seeds");if(!(null==n?void 0:n.hasChildNodes))return[];const s=null==n?void 0:n.querySelectorAll("li"),i=null==s?void 0:s.length,l=[];for(let e=0;e<i;e++){const t=s[e].dataset.id;null!=t&&l.push(t)}return l}getPlaylist(){return i(this,void 0,void 0,(function*(){const e=this.getSeeds("artist").join(","),t=this.getSeeds("track").join(",");let n=`${this.config.apiURL}/rec\n\t\t\t?seed_artists=${e}\n\t\t\t&seed_tracks=${t}\n\t\t\t&target_danceability=${this.danceability.value}\n\t\t\t&target_energy=${this.energy.value}\n\t\t\t&target_popularity=${this.popularity.value}\n\t\t\t&target_valence=${this.valence.value}\n\t\t`;console.log(n);const s=yield fetch(n,{method:"GET",credentials:"include"}),i=(yield s.json()).tracks;this.addTracksToPlaylist(i)}))}addTracksToPlaylist(e){this.playlistOrdered.replaceChildren();const t=[];e.forEach((e=>{const n=document.createElement("li");n.textContent=e.artists[0].name+" - "+e.name,t.push(e.uri),this.playlistOrdered.appendChild(n)})),this.playlistElement.hidden=!1,this.savePlaylistButton.addEventListener("click",(e=>{this.addPlaylistToUserLibray(t)})),this.savePlaylistButton.classList.remove("hidden"),this.playlistElement.classList.remove("hidden")}addPlaylistToUserLibray(e){var t;return i(this,void 0,void 0,(function*(){const n={uris:[]};n.uris=e;const s=yield fetch(this.config.apiURL+"/playlist",{method:"POST",credentials:"include",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})}),i=yield s.json(),l=document.createElement("a");l.href=`https://open.spotify.com/user/${i.username}/playlist/${i.id}`,l.target="_blank",l.textContent=l.href,this.clearPlaylist(),null===(t=this.shadowRoot)||void 0===t||t.appendChild(l)}))}clearPlaylist(){this.playlistOrdered.replaceChildren(),this.playlistElement.classList.add("hidden")}}class a extends HTMLElement{connectedCallback(){const e=document.createElement("button");e.type="button",e.textContent=this.textContent,e.addEventListener("click",this.handleButtonClick.bind(this)),this.replaceChildren(e)}handleButtonClick(){location.href=this.dataset.href||"#"}}s=function*(){window.customElements.define("app-container",l),window.customElements.define("link-button",a);const e=document.getElementById("app");try{const n=yield fetch(t().apiURL+"/auth",{method:"GET",credentials:"include"}),s=document.querySelector("header");if(n.ok){s.innerHTML+=`<link-button data-href='${t().apiURL}/auth/logout'>Logout</link-button>`;const n=document.createElement("app-container");e.appendChild(n)}else s.innerHTML+=`<link-button data-href='${t().apiURL}/auth/login'>Login with Spotify</link-button>`}catch(e){console.error(e);let t="Something went wrong...";"TypeError: Failed to fetch"==e&&(t="Unable to fetch server :("),console.log(t)}},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{a(s.next(e))}catch(e){t(e)}}function l(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,l)}a((s=s.apply(void 0,[])).next())}))})();