(()=>{"use strict";const e=JSON.parse('{"QH":"http://localhost:3000"}');var t,n,s=function(e,t,n,s){return new(n||(n=Promise))((function(l,i){function a(e){try{r(s.next(e))}catch(e){i(e)}}function d(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}r((s=s.apply(e,t||[])).next())}))};class l extends HTMLElement{connectedCallback(){const e=this.attachShadow({mode:"open"}),t=document.getElementById("app-template");e.appendChild(t.content.cloneNode(!0)),this.searchElement=e.getElementById("search"),this.searchTypeElement=e.getElementById("search-method"),this.searchResultsElement=e.getElementById("search-results"),this.getPlaylistButton=e.getElementById("get-playlist"),this.danceability=e.getElementById("danceability"),this.energy=e.getElementById("energy"),this.popularity=e.getElementById("popularity"),this.valence=e.getElementById("valence"),this.seedsElement={artist:e.getElementById("artist-seeds"),track:e.getElementById("track-seeds")},this.playlistElement=e.getElementById("playlist"),this.playlistOrdered=e.getElementById("playlist-ordered"),this.savePlaylistButton=e.getElementById("save-playlist"),this.clearPlaylistButton=e.getElementById("clear-playlist"),this.resultsElement=e.getElementById("results"),this.searchElement.addEventListener("keyup",this.handleSearchKeyup.bind(this)),this.searchElement.addEventListener("search",this.handleSearchEvent.bind(this)),this.searchTypeElement.addEventListener("change",this.searchQuery.bind(this)),this.getPlaylistButton.addEventListener("click",this.handleGetPlaylistButtonClick.bind(this)),this.clearPlaylistButton.addEventListener("click",this.clearPlaylist.bind(this))}handleSearchKeyup(e){this.searchElement.value||this.clearResults(),"Enter"===e.key&&this.searchQuery()}handleSearchEvent(e){this.searchElement.value||this.clearResults()}handleGetPlaylistButtonClick(e){if(!this.hasSeeds())return console.error("The button abides");this.clearResults(),this.getPlaylist()}searchQuery(){var t;return s(this,void 0,void 0,(function*(){const n=this.searchElement.value;if(!n||n.length<1)return;const s=null===(t=this.searchTypeElement.querySelector('input[type="radio"]:checked').parentElement)||void 0===t?void 0:t.textContent;if("artist"!=s&&"track"!=s)return console.error("invalid type");const l=`${e.QH}/search?q=${n}&type=${s}`;try{const e=yield fetch(l,{method:"GET",credentials:"include"}),t=(yield e.json())[s+"s"].items;this.showResults(t)}catch(e){console.error(e)}}))}showResults(e){var t;null===(t=this.searchResultsElement)||void 0===t||t.replaceChildren(),e.forEach((e=>{var t;const n=document.createElement("li");let s=e.name;"track"==e.type&&(s=e.artists[0].name+" - "+s),n.textContent=s,n.dataset.id=e.id,n.dataset.type=e.type,n.addEventListener("click",this.addItemToSeeds.bind(this)),null===(t=this.searchResultsElement)||void 0===t||t.appendChild(n)}))}clearResults(){this.searchResultsElement.replaceChildren()}addItemToSeeds(e){const t=e.target,n=this.seedsElement[t.dataset.type],s=null==n?void 0:n.querySelectorAll("li");let l=!0;if(null!=s){if(s.length>=5)return void alert("Max of 5 items per seed");null==s||s.forEach((e=>{e.dataset.id!=t.dataset.id||(l=!1)}))}if(l){const e=document.createElement("li");e.textContent=t.textContent,e.dataset.id=t.dataset.id,e.addEventListener("click",this.deleteItemFromSeeds.bind(this)),null==n||n.appendChild(e)}this.checkButton()}deleteItemFromSeeds(e){e.target.remove(),this.checkButton()}hasSeeds(){var e,t,n,s;const l=(null===(t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("artist-seeds"))||void 0===t?void 0:t.hasChildNodes())||!1,i=(null===(s=null===(n=this.shadowRoot)||void 0===n?void 0:n.getElementById("track-seeds"))||void 0===s?void 0:s.hasChildNodes())||!1;return l||i}checkButton(){var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("get-playlist");this.hasSeeds()?t.disabled=!1:t.disabled=!0}getSeeds(e){var t;const n=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById(e+"-seeds");if(!(null==n?void 0:n.hasChildNodes))return[];const s=null==n?void 0:n.querySelectorAll("li"),l=null==s?void 0:s.length,i=[];for(let e=0;e<l;e++){const t=s[e].dataset.id;null!=t&&i.push(t)}return i}getPlaylist(){return s(this,void 0,void 0,(function*(){const t=this.getSeeds("artist").join(","),n=this.getSeeds("track").join(",");let s=`${e.QH}/rec\n\t\t\t?seed_artists=${t}\n\t\t\t&seed_tracks=${n}\n\t\t\t&target_danceability=${this.danceability.value}\n\t\t\t&target_energy=${this.energy.value}\n\t\t\t&target_popularity=${this.popularity.value}\n\t\t\t&target_valence=${this.valence.value}\n\t\t`;const l=yield fetch(s,{method:"GET",credentials:"include"}),i=(yield l.json()).tracks;this.addTracksToPlaylist(i)}))}addTracksToPlaylist(e){this.playlistOrdered.replaceChildren();const t=[];e.forEach((e=>{const n=document.createElement("li");n.textContent=e.artists[0].name+" - "+e.name,t.push(e.uri),this.playlistOrdered.appendChild(n)})),this.playlistElement.hidden=!1,this.savePlaylistButton.addEventListener("click",(e=>{this.addPlaylistToUserLibray(t)})),this.savePlaylistButton.classList.remove("hidden"),this.playlistElement.classList.remove("hidden")}addPlaylistToUserLibray(t){return s(this,void 0,void 0,(function*(){const n={uris:[]};n.uris=t;const s=yield fetch(e.QH+"/playlist",{method:"POST",credentials:"include",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})}),l=yield s.json(),i=document.createElement("a");i.href=`https://open.spotify.com/user/${l.username}/playlist/${l.id}`,i.target="_blank",i.textContent=i.href,this.resultsElement.replaceChildren(i),this.clearPlaylist()}))}clearPlaylist(){this.playlistOrdered.replaceChildren(),this.playlistElement.classList.add("hidden")}}class i extends HTMLElement{connectedCallback(){const e=document.createElement("button");e.type="button",e.textContent=this.textContent,e.addEventListener("click",this.handleButtonClick.bind(this)),this.replaceChildren(e)}handleButtonClick(){location.href=this.dataset.href||"#"}}n=function*(){window.customElements.define("app-container",l),window.customElements.define("link-button",i);const t=document.getElementById("app");try{const n=yield fetch(e.QH+"/auth",{method:"GET",credentials:"include"}),s=document.querySelector("header");if(n.ok){s.innerHTML+=`<link-button data-href='${e.QH}/auth/logout'>Logout</link-button>`;const n=document.createElement("app-container");t.appendChild(n)}else s.innerHTML+=`<link-button data-href='${e.QH}/auth/login'>Login with Spotify</link-button>`}catch(e){console.error(e);let t="Something went wrong...";"TypeError: Failed to fetch"==e&&(t="Unable to fetch server :("),console.log(t)}},new((t=void 0)||(t=Promise))((function(e,s){function l(e){try{a(n.next(e))}catch(e){s(e)}}function i(e){try{a(n.throw(e))}catch(e){s(e)}}function a(n){var s;n.done?e(n.value):(s=n.value,s instanceof t?s:new t((function(e){e(s)}))).then(l,i)}a((n=n.apply(void 0,[])).next())}))})();